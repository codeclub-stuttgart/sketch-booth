<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Sketch booth</title>
  </head>
  <body>


    <input type="file" name="sketch" id="fileinput">


    <img id="preview">


    <script src="./vendor/potrace.js"></script>
    <script>


      (function () {
        'use strict'

        var form = document.getElementById('form');
        var fileInput = document.getElementById('fileinput');
        var preview = document.getElementById('preview');
        var file;


        fileInput.addEventListener('change', function (e) {
          var fileList = e.target.files;


          if (fileList.length > 0) {
            Potrace.loadImageFromFile(fileList[0]);

            Potrace.process(function () {
              var data = new Blob([Potrace.getSVG(1)], {type: 'image/svg+xml'});

              if (file !== null) {
                window.URL.revokeObjectURL(file);
              }

              file = window.URL.createObjectURL(data)


              preview.src = file;


              var formData = new FormData();
              formData.append('sketch', data, 'sketch.svg');


              var request = new XMLHttpRequest();
              request.open('POST', '/sketch');
              request.send(formData);

              console.log('send request');


            })
          }
        })

      }())

    </script>

  </body>
</html>
